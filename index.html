<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Paperweight - Salary Tracker</title>
        <meta name="description" content="Money is fun! Why shouldn't earning it be too?">
        <meta name="author" content="Created by Kyle Johnson">
        <link rel="stylesheet" href="css/jquery.timepicker.css">
    </head>

    <body>
        <!-- Begin JS -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script src="js/jquery.timepicker.js"></script>
        <script src="js/moment.js"></script>
        <script>
            var timeFormat = 'hh:mm a';
            
            var startTime = '7:00am';
            var endTime = moment(startTime, timeFormat).add(12, 'hours').format(timeFormat)
            
            var paidHours = '';
            var salary = '';
            var wage = '';

            $(function() {
                $('#start').timepicker({
                    'minTime': startTime,
                    'maxTime': endTime
                });

                $('#end').timepicker({
                    'minTime': startTime,
                    'maxTime': endTime,
                    'showDuration': true
                });
                
                $('#start, #end').change(function() {
                    updateRange();
                    calculateShift();
                });
                
                $('#paid').change(function() {
                    paidHours = $(this).val();
                    $('#paidHours').text('Total hours paid: ' + paidHours + ' hours')
                });
                
                // comment out line to show all at once
                $('#step2, #salary, #hourly, #calcHourly').hide();
                
                $('input[name=pay]').change(function() {
                    var pay = $(this).val();
                    if (pay == "salary") {
                        $('#salary').show();
                        $('#hourly').hide();
                    } else if (pay == "hourly") {
                        $('#hourly').show();
                        $('#salary').hide();
                    }
                });
                
                $('#hourly_input, #paid, #start, #end').change(function() {
                    calculateHourlyData();
                    calculateSalaryData(true);
                });
                
                $('#salary_input, #paid, #start, #end').change(function() {
                    calculateSalaryData();
                    calculateHourlyData(true);
                });
            });

            function updateRange() {
                var startTime = moment($('#start').val(), timeFormat);
                var endTime = moment($('#start').val(), timeFormat).add(12, 'hours');
                $('#end').timepicker('option', 'minTime', startTime.format(timeFormat));
                $('#end').timepicker('option', 'maxTime', endTime.format(timeFormat));
            }

            function calculateShift() {
                if ($('#start').val() && $('#end').val()) {
                    var startTime = moment($('#start').val(), timeFormat);
                    var endTime = moment($('#end').val(), timeFormat);
                    var duration = moment.duration(endTime.diff(startTime));
                    var paidDuration = moment.duration(endTime.diff(startTime));
                    $('#hours').text('Total shift length: ' + duration.asHours() + ' hours');
                    $('#step2').show();

                    paidHours = paidDuration.asHours()
                    $('#paid').val(paidHours);
                    $('#paidHours').text('Total hours paid: ' + paidHours + ' hours')
                }
            }
            
            function calculateHourlyData(secondary = false) {
                if (paidHours == '') { return; }
                
                if (!secondary) {
                    wage = $('#hourly_input').val();
                } else {
                    var truncatedWage = Math.trunc(wage*100)/100;
                    if (value > 0) {
                        $('#hourly_input').val(truncatedWage);
                    }
                }
                salary = Math.trunc(wage*paidHours*5*52);
                
                if (salary != '') {
                    $('#annualSalary').text('Annual salary equivalent: $' + salary + '/year');
                    $('#calcHourly').show();
                    updateConversions();
                }
            }
            
            function calculateSalaryData(secondary = false) {
                if (paidHours == '') { return; }
                
                if (!secondary) {
                    salary = $('#salary_input').val();
                } else {
                    if (salary > 0) {
                        $('#salary_input').val(salary);
                    }
                }
                wage = salary/52/paidHours/5;
                
                if (wage != '') {
                    $('#hourlyRate').text('Hourly rate equivalent: $' + Math.trunc(wage*100)/100 + '/hour');
                    $('#calcSalary').show();
                    updateConversions();
                }
            }
            
            function updateConversions() {
                var dayEarnings = Math.trunc(wage*paidHours)
                var weeklyEarnings = Math.trunc(dayEarnings*5)
                var monthlyEarnings = Math.trunc(salary/12)
                var truncatedWage = Math.trunc(wage*100)/100
                
                $('#dayEarnings').text('$' + truncatedWage + ' * ' + paidHours + ' hours' + ' = $' + dayEarnings + '/day');
                $('#weeklyEarnings').text('Weekly earnings: $' + weeklyEarnings + '/week');
                $('#monthlyEarnings').text('Monthly earnings: $' + monthlyEarnings + '/month');
                
                $('#conversions').show()
            }
        </script> 
        <!-- End JS -->

        <h2>Paperweight - Salary Visualizer</h2>

        <form>
            <div>
                When does your shift start?
                <input id="start" type="text" spellcheck="false" />
            </div>
            <div>
                When does your shift end?&nbsp
                <input id="end" type="text" spellcheck="false" />
            </div>
            <div id="hours"></div>
            <br>
            
            <div id="step2">
                <div>
                    Paid hours&nbsp
                    <input id="paid" type="number" spellcheck="false" step="0.5"/>
                </div>
                <div id="paidHours"></div>
                <br>
                <div>
                    How are you paid? <br>
                    <input type="radio" name="pay" value="hourly" />Hourly<br>
                    <input type="radio" name="pay" value="salary" />Salary<br>
                </div>
                <br> 

                <div id="hourly">
                    <div>
                        What is your hourly rate? &nbsp&nbsp&nbsp
                        <span style="position: absolute; margin-left: 3px; margin-top: 1px;">$</span>
                        <input id="hourly_input" type="text" style="padding-left: 10px; width: 100px;" />
                    </div>
                    <div id="calcHourly">
                        <div id="annualSalary"></div>
                        <br>
                    </div>
                </div>

                <div id="salary">
                    <div>
                        What is your annual salary?
                        <span style="position: absolute; margin-left: 3px; margin-top: 1px;">$</span>
                        <input id="salary_input" type="text" style="padding-left: 10px; width: 100px;" />
                    </div>
                    <div id="calcSalary">
                        <div id="hourlyRate"></div>
                        <br>
                    </div>
                </div>
                
                <div id="conversions">
                    <div id="dayEarnings"></div>
                    <div id="weeklyEarnings"></div>
                    <div id="monthlyEarnings"></div>
                </div>
            </div>
        </form>
    </body>
</html>

<style>
h2 {
    color: rgb(41, 141, 41);
}
</style>